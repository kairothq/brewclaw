# Plan 03-03: Web Audio Integration and Sound Toggle

## Metadata

```yaml
phase: 3
plan: 3
wave: 2
title: Web Audio Integration for SplitFlap Sounds
depends_on:
  - 03-02
files_modified:
  - src/components/split-flap-text.tsx (update - ensure audio works)
  - src/components/hero-section.tsx (update - position sound toggle)
requirements:
  - HERO-03
autonomous: true
estimated_minutes: 6
```

## Goal

Ensure the Web Audio API integration for SplitFlap sounds works correctly, with sound muted by default and a visible toggle to enable it. Position the toggle appropriately in the hero section.

## Must Haves

- [ ] SplitFlap audio is muted by default
- [ ] Sound toggle is visible when in SplitFlap mode
- [ ] Toggle shows current state (Volume2 for on, VolumeX for off)
- [ ] Clicking toggle enables/disables mechanical flip sounds
- [ ] Audio context resumes on user interaction (browser requirement)

## Tasks

<task id="1">
Verify SplitFlap audio implementation in `src/components/split-flap-text.tsx`:
- Confirm isMuted defaults to true in useState
- Confirm playClick checks isMuted before playing
- Verify AudioContext is lazy-initialized (only created when needed)
- Ensure haptic feedback (navigator.vibrate) is also gated by isMuted
- Test that oscillator creates mechanical click sound
</task>

<task id="2">
Verify SplitFlapMuteToggle component styling:
- Uses font-mono text-[10px] uppercase tracking-widest
- Shows VolumeX icon when muted, Volume2 when unmuted
- Text shows "Sound Off" / "Sound On"
- Hover state: text-muted-foreground hover:text-foreground
- Has proper aria-label for accessibility
</task>

<task id="3">
Position sound toggle in hero-section.tsx:
- Only render SplitFlapMuteToggle when heroStyle === 'splitflap'
- Position below the SplitFlapText with mt-4 spacing
- Center align with the text
- Ensure it's wrapped inside SplitFlapAudioProvider
</task>

<task id="4">
Test audio functionality:
- Load page with ?hero=splitflap
- Verify no sound plays on initial load (muted by default)
- Click sound toggle to enable
- Hover over BREWCLAW text to trigger re-animation
- Confirm mechanical click sounds play
- Toggle off, confirm sounds stop
- Test on mobile: no errors even if AudioContext not supported
</task>

<task id="5">
Add fallback handling for unsupported browsers:
- Ensure try/catch blocks around AudioContext creation
- SplitFlapMuteToggle should gracefully handle null audio context
- No console errors when Web Audio is unavailable
</task>

## Verification

```bash
# Check audio defaults to muted
grep "useState(true)" src/components/split-flap-text.tsx

# Check toggle renders conditionally
grep "SplitFlapMuteToggle" src/components/hero-section.tsx
```

## Acceptance Criteria

1. Audio is silent on initial page load with SplitFlap mode
2. Sound toggle is visible and shows muted state
3. Toggling enables mechanical click sounds during animation
4. No errors in browsers without Web Audio support
5. Accessibility: toggle has proper aria-label
